(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4916],{9446:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users/edit",function(){return s(627)}])},627:function(e,a,s){"use strict";s.r(a);var l=s(5893),t=s(7294),r=s(1163),i=s(6761),n=s(591),d=s(4082),m=s(2983),c=s(9180),u=s(4105),o=s(5822),x=s(897),h=s(4549),f=s(7219);a.default=()=>{let{user:e,isAuthenticated:a}=(0,i.a)(),s=(0,r.useRouter)(),{userId:v}=s.query,[j,p]=(0,t.useState)({firstName:"",lastName:"",email:"",role:"student",departmentId:"",status:"active"}),[N,g]=(0,t.useState)([]),[b,y]=(0,t.useState)(!0),[S,C]=(0,t.useState)(!1),[I,w]=(0,t.useState)(null),[_,E]=(0,t.useState)(null),[Z,U]=(0,t.useState)({});(0,t.useEffect)(()=>{if(!a||(null==e?void 0:e.role)!=="admin"){s.push("/dashboard");return}},[a,e,s]),(0,t.useEffect)(()=>{v&&a&&(null==e?void 0:e.role)==="admin"&&fetchData()},[v,a,e]);let fetchData=async()=>{try{var e;y(!0),w(null);let[a,s]=await Promise.all([n.Sb.getUserById(parseInt(v)),n.Sb.getAllDepartments()]);p({firstName:a.first_name||"",lastName:a.last_name||"",email:a.email||"",role:a.role||"student",departmentId:(null===(e=a.department_id)||void 0===e?void 0:e.toString())||"",status:a.status||"active"}),g(s)}catch(e){w("Failed to load user data. Please try again.")}finally{y(!1)}},handleInputChange=e=>{let{name:a,value:s}=e.target;p(e=>({...e,[a]:s})),Z[a]&&U(e=>({...e,[a]:null}))},validateForm=()=>{let e={};return j.firstName.trim()||(e.firstName="First name is required"),j.lastName.trim()||(e.lastName="Last name is required"),j.email.trim()?/\S+@\S+\.\S+/.test(j.email)||(e.email="Email is invalid"):e.email="Email is required",j.role||(e.role="Role is required"),U(e),0===Object.keys(e).length},handleSubmit=async e=>{if(e.preventDefault(),validateForm())try{C(!0),w(null);let e={firstName:j.firstName.trim(),lastName:j.lastName.trim(),email:j.email.trim().toLowerCase(),role:j.role,departmentId:j.departmentId||null,status:j.status};await n.Sb.updateUser(parseInt(v),e),E({type:"success",text:"User updated successfully!"}),setTimeout(()=>{s.push("/admin/users")},2e3)}catch(e){w(e.message||"Failed to update user. Please try again.")}finally{C(!1)}};return a&&(null==e?void 0:e.role)==="admin"?b?(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)(d.default,{}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(m.default,{}),(0,l.jsx)("main",{className:"flex-1 p-6 flex justify-center items-center",children:(0,l.jsx)(h.Z,{size:"lg"})})]})]}):I&&!j.firstName?(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)(d.default,{}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(m.default,{}),(0,l.jsx)("main",{className:"flex-1 p-6",children:(0,l.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"text-red-500 mr-3",children:(0,l.jsx)(f.fzv,{className:"w-6 h-6"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-red-800",children:"Error Loading User"}),(0,l.jsx)("p",{className:"text-red-600 mt-1",children:I})]})]}),(0,l.jsx)("div",{className:"mt-4",children:(0,l.jsx)(c.Z,{variant:"outline",onClick:()=>s.push("/admin/users"),icon:f.Ao2,children:"Back to Users"})})]})})})]})]}):(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsx)(d.default,{}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)(m.default,{}),(0,l.jsx)("main",{className:"flex-1 p-6",children:(0,l.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,l.jsx)("div",{className:"mb-6",children:(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(c.Z,{variant:"outline",onClick:()=>s.push("/admin/users"),icon:f.Ao2,className:"mr-4",children:"Back"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit User"}),(0,l.jsx)("p",{className:"text-gray-600 mt-1",children:"Update user information"})]})]})})}),_&&(0,l.jsx)("div",{className:"mb-6 p-4 rounded-lg border-l-4 ".concat("success"===_.type?"bg-green-50 border-green-400 text-green-800":"bg-red-50 border-red-400 text-red-800"),children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.fzv,{className:"w-5 h-5 mr-2"}),(0,l.jsx)("span",{className:"font-medium",children:_.text})]})}),I&&(0,l.jsx)("div",{className:"mb-6 p-4 rounded-lg border-l-4 bg-red-50 border-red-400 text-red-800",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(f.H33,{className:"w-5 h-5 mr-2"}),(0,l.jsx)("span",{className:"font-medium",children:I})]})}),(0,l.jsx)(u.Z,{children:(0,l.jsx)("div",{className:"p-6",children:(0,l.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(o.Z,{label:"First Name",name:"firstName",value:j.firstName,onChange:handleInputChange,error:Z.firstName,required:!0,icon:f.fzv}),(0,l.jsx)(o.Z,{label:"Last Name",name:"lastName",value:j.lastName,onChange:handleInputChange,error:Z.lastName,required:!0,icon:f.fzv})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Information"}),(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)(o.Z,{label:"Email Address",name:"email",type:"email",value:j.email,onChange:handleInputChange,error:Z.email,required:!0,icon:f.Imn})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Role and Department"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(x.Z,{label:"Role",name:"role",value:j.role,onChange:handleInputChange,options:[{value:"student",label:"Student"},{value:"teacher",label:"Teacher"},{value:"hod",label:"Head of Department"},{value:"finance",label:"Finance Officer"},{value:"admin",label:"Administrator"}],error:Z.role,required:!0}),(0,l.jsx)(x.Z,{label:"Department",name:"departmentId",value:j.departmentId,onChange:handleInputChange,options:[{value:"",label:"Select Department (Optional)"},...N.map(e=>({value:e.id.toString(),label:e.name}))]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Account Status"}),(0,l.jsx)(x.Z,{label:"Status",name:"status",value:j.status,onChange:handleInputChange,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"suspended",label:"Suspended"},{value:"pending",label:"Pending"}],required:!0})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,l.jsx)(c.Z,{type:"button",variant:"outline",onClick:()=>s.push("/admin/users"),disabled:S,children:"Cancel"}),(0,l.jsx)(c.Z,{type:"submit",variant:"primary",icon:f.mW3,disabled:S,loading:S,children:S?"Updating User...":"Update User"})]})]})})})]})})]})]}):null}}},function(e){e.O(0,[1216,8592,2888,179],function(){return e(e.s=9446)}),_N_E=e.O()}]);