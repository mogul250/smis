(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1833],{6150:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/departments/edit",function(){return s(1353)}])},1353:function(e,t,s){"use strict";s.r(t);var a=s(5893),r=s(7294),n=s(1163),d=s(6761),l=s(591),i=s(4082),c=s(2983);t.default=()=>{let{user:e,isAuthenticated:t}=(0,d.a)(),s=(0,n.useRouter)(),{departmentId:o}=s.query,[m,u]=(0,r.useState)(null),[h,x]=(0,r.useState)(!0),[p,b]=(0,r.useState)(!1),[g,f]=(0,r.useState)(null),[j,y]=(0,r.useState)(!1),[N,v]=(0,r.useState)([]),[w,D]=(0,r.useState)({name:"",code:"",description:"",head_id:"",status:"active"}),[C,_]=(0,r.useState)({}),fetchDepartment=async()=>{if(o)try{x(!0);let e=await l.Sb.getDepartmentById(parseInt(o));e&&(u(e),D({name:e.name||"",code:e.code||"",description:e.description||"",head_id:e.head_id||"",status:e.status||"active"}))}catch(e){f(e.message||"Failed to fetch department details")}finally{x(!1)}},fetchTeachers=async()=>{try{let e=await l.Sb.getAllUsers(1,100,{role:"teacher"});e&&e.users?v(e.users):Array.isArray(e)&&v(e)}catch(e){}};(0,r.useEffect)(()=>{t&&(null==e?void 0:e.role)==="admin"&&(fetchDepartment(),fetchTeachers())},[t,e,o]);let handleInputChange=e=>{let{name:t,value:s}=e.target;D(e=>({...e,[t]:s})),C[t]&&_(e=>({...e,[t]:""}))},validateForm=()=>{let e={};return w.name.trim()?w.name.length<2&&(e.name="Department name must be at least 2 characters"):e.name="Department name is required",w.code.trim()?w.code.length<2?e.code="Department code must be at least 2 characters":/^[A-Z0-9]+$/.test(w.code)||(e.code="Department code must contain only uppercase letters and numbers"):e.code="Department code is required",w.description&&w.description.length>500&&(e.description="Description must be less than 500 characters"),_(e),0===Object.keys(e).length},handleSubmit=async e=>{if(e.preventDefault(),validateForm())try{b(!0),f(null);let e={name:w.name.trim(),code:w.code.trim().toUpperCase(),description:w.description.trim()||null,head_id:w.head_id?parseInt(w.head_id):null,status:w.status};await l.Sb.updateDepartment(parseInt(o),e),y(!0),setTimeout(()=>{s.push("/admin/departments")},2e3)}catch(e){f(e.message||"Failed to update department")}finally{b(!1)}};return t&&(null==e?void 0:e.role)==="admin"?h?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading department..."})]})}):g&&!m?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:g}),(0,a.jsx)("button",{onClick:()=>s.push("/admin/departments"),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Back to Departments"})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(i.default,{}),(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(c.default,{}),(0,a.jsxs)("main",{className:"flex-1 p-6",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>s.back(),className:"mr-4 p-2 text-gray-400 hover:text-gray-600 rounded-lg hover:bg-gray-100",children:"← Back"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Department"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Update department information"})]})]})}),j&&(0,a.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 text-green-600 mr-3",children:"✓"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-green-800",children:"Department Updated Successfully!"}),(0,a.jsx)("p",{className:"text-sm text-green-700 mt-1",children:"Redirecting to departments list..."})]})]})}),g&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 text-red-600 mr-3",children:"!"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:g})]})]})}),(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-5 h-5 text-blue-600 mr-2",children:"\uD83C\uDFE2"}),(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Department Information"})]})}),(0,a.jsxs)("form",{onSubmit:handleSubmit,className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Department Name *"}),(0,a.jsx)("input",{type:"text",id:"name",name:"name",value:w.name,onChange:handleInputChange,className:"w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(C.name?"border-red-300":"border-gray-300"),placeholder:"e.g., Computer Science",disabled:p}),C.name&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700 mb-2",children:"Department Code *"}),(0,a.jsx)("input",{type:"text",id:"code",name:"code",value:w.code,onChange:handleInputChange,className:"w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(C.code?"border-red-300":"border-gray-300"),placeholder:"e.g., CS, ENG, MATH",disabled:p,style:{textTransform:"uppercase"}}),C.code&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.code}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Use uppercase letters and numbers only"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{id:"description",name:"description",value:w.description,onChange:handleInputChange,rows:4,className:"w-full px-3 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent ".concat(C.description?"border-red-300":"border-gray-300"),placeholder:"Brief description of the department...",disabled:p}),C.description&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.description}),(0,a.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:[w.description.length,"/500 characters"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"head_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Head of Department"}),(0,a.jsxs)("select",{id:"head_id",name:"head_id",value:w.head_id,onChange:handleInputChange,className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p,children:[(0,a.jsx)("option",{value:"",children:"Select a teacher (optional)"}),N.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.firstName," ",e.lastName," (",e.email,")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),(0,a.jsxs)("select",{id:"status",name:"status",value:w.status,onChange:handleInputChange,className:"w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:p,children:[(0,a.jsx)("option",{value:"active",children:"Active"}),(0,a.jsx)("option",{value:"inactive",children:"Inactive"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200",children:[(0,a.jsx)("button",{type:"button",onClick:()=>s.back(),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:p,children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:p,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full"}),"Updating..."]}):(0,a.jsx)(a.Fragment,{children:"\uD83D\uDCBE Update Department"})})]})]})]})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"You need admin privileges to access this page."})]})})}}},function(e){e.O(0,[1216,8592,2888,179],function(){return e(e.s=6150)}),_N_E=e.O()}]);